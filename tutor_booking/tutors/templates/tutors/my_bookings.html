<h1>My reservations</h1>

<form method="get" style="margin-bottom: 20px;">
  <label for="status">Filter by status:</label>
  <select name="status" id="status" onchange="this.form.submit()">
    <option value="">All</option>
    <option value="pending" {% if request.GET.status =='pending' %} selected {% endif %}>Pending</option>
    <option value="confirmed" {% if request.GET.status =='confirmed' %} selected {% endif %}>Confirmed</option>
    <option value="cancelled" {% if request.GET.status =='cancelled' %} selected {% endif %}>Cancelled</option>
  </select>
</form>

{% if bookings %}
  {% for booking in bookings %}
    <div style="margin-bottom: 20px; padding: 10px; border: 1px solid #ccc;">
      <p><strong>Date and time:</strong> {{ booking.datetime|date:"F d, Y, H:i" }}</p>

      {% if request.user.role == 'student' %}
        <p><strong>To tutor:</strong> {{ booking.tutor.username }}</p>
      {% elif request.user.role == 'tutor' %}
        <p><strong>From student:</strong> {{ booking.student.username }}</p>
      {% endif %}

            <p>
        <strong>Status:</strong>
        {% if booking.status == 'pending' %}
          <span style="color: orange;">ðŸŸ¡ Pending</span>
        {% elif booking.status == 'confirmed' %}
          <span style="color: green;">ðŸŸ¢ Confirmed</span>
        {% elif booking.status == 'cancelled' %}
          <span style="color: gray;">ðŸ”´ Cancelled</span>
        {% endif %}
      </p>

      {% if request.user.role == 'student' and booking.status != 'cancelled' %}
        <form method="post" action="{% url 'cancel_booking' booking.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" style="color: red;">Cancel</button>
        </form>
      {% endif %}

      {% if request.user.role == 'tutor' and booking.status == 'pending' %}
        <form method="post" action="{% url 'confirm_booking' booking.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" style="color: green;">Confirm</button>
        </form>
      {% endif %}
      </div>
      {% endfor %}
    {% else %}
      <p>ðŸ˜” You donâ€™t have any bookings yet.</p>
    {% endif %}
